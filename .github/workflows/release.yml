name: Dispatch relevant publish workflow

on:
  release:
    types: [published]

jobs:
  latest-tag:
    runs-on: ubuntu-latest
    outputs:
      tag: ${{ steps.latest-tag.outputs.tag }}
      project: ${{ steps.breakdown.outputs.project }}
      version-number: ${{ steps.breakdown.outputs.vernum }}
    steps:
      - uses: actions/checkout@v2.3.3
        with:
          fetch-depth: 0
      - name: Get latest tag
        id: latest-tag
        uses: WyriHaximus/github-action-get-previous-tag@v1
      - name: Tag breakdown
        id: breakdown
        run: |
          project=$(echo ${{ steps.latest-tag.outputs.tag }} | grep -o '^[^0-9]\+')
          vernum=$(echo ${{ steps.latest-tag.outputs.tag }} | grep -o '[0-9.]\+$')
          echo "project=$project" >> $GITHUB_OUTPUT
          echo "vernum=$vernum" >> $GITHUB_OUTPUT

  test-tag:
    needs: latest-tag
    runs-on: ubuntu-latest
    steps:
      - name: Print tag data
        run: |
          echo "Tag: ${{ needs.latest-tag.outputs.tag }}"
          echo "Project: ${{ needs.latest-tag.outputs.project }}"
          echo "Version number: ${{ needs.latest-tag.outputs.version-number }}"

